.. _powervm_lpar_instance_module:


powervm_lpar_instance -- Create, Delete, Shutdown, Activate, Restart and facts of an AIX/Linux or IBMi partition
================================================================================================================

.. contents::
   :local:
   :depth: 1


Synopsis
--------

Creates AIX/Linux or IBMi partition with specified configuration details on mentioned system

Or Deletes specified AIX/Linux or IBMi partition on specified system

Or Shutdown specified AIX/Linux or IBMi partition on specified system

Or Poweron/Activate specified AIX/Linux or IBMi partition with provided configuration details on the mentioned system

Or Restart specified AIX/Linux or IBMi partition on specified system

Or facts of the specified AIX/Linux or IBMi partition of specified system



Requirements
------------
The below requirements are needed on the host that executes this module.

- Python >= 3
- lxml



Parameters
----------

  hmc_host (True, str, None)
    The ipaddress or hostname of HMC


  hmc_auth (True, dict, None)
    Username and Password credential of HMC


    username (True, str, None)
      HMC user name


    password (optional, str, None)
      HMC password



  system_name (True, str, None)
    The name of the managed system


  vm_name (True, str, None)
    The name of the powervm partition to create/delete


  proc (optional, int, None)
    The number of dedicated processors to create partition.

    If ``proc_unit`` parameter is set, then this value will work as Virtual Processors for shared processor setting

    Default value is 2. This will not work during shared processor setting


  proc_unit (optional, float, None)
    The number of shared processing units to create partition.


  mem (optional, int, None)
    The value of dedicated memory value in megabytes to create partition.

    Default value is 2048 MB.


  os_type (optional, str, None)
    Type of logical partition to be created

    ``aix_linux`` or ``linux`` or ``aix`` for AIX or Linux operating system

    ``ibmi`` for IBMi operating system


  prof_name (optional, str, None)
    Partition profile needs to be used to activate

    If user doesn't provide this option, current configureation of partition will be used for activation

    This option is valid only for poweron action


  keylock (optional, str, None)
    The keylock position to set.

    If user doesn't provide this option, current settings of this option in partition will be considered.

    This option is valid only for poweron action


  iIPLsource (optional, str, None)
    The inital program load (IPL) source to use when activating an IBMi partition.

    If user doesn't provide this option, current setting of this option in partition will be considered.

    If this option provided to AIX/Linux type partition, operation gives a warning and then ignores this option and proceed with operation.

    This option is valid only for poweron action


  volume_config (optional, dict, None)
    Storage volume configurations of partition

    Attaches Physical Volume via Virtual SCSI

    Redundant paths created by default, if the specified/identified physical volume is visible in more than one VIOS.

    User needs to provide either *volume_size* or both *volume_name* and *vios_name*. If *volume_size* is provided, available physical volume matching or greater than specified size would be attached.


    volume_name (optional, str, None)
      Physical volume name visible through VIOS. This option is mutually exclusive with *volume_size*


    vios_name (optional, str, None)
      VIOS name to which mentioned *volume_name* is present. This option is mutually exclusive with *volume_size*


    volume_size (optional, int, None)
      Physical volume size in MB



  virt_network_config (optional, dict, None)
    Virtual Network configuration of the partition

    This implicitly adds a Virtual Ethernet Adapter with given virtual network to the partition

    Make sure provided Virtual Network has been attached to an active Network Bridge for external network communication


    network_name (True, str, None)
      Virtual Network Name to be attached to the partition. This parameter is mandatory with *virt_network_config*


    slot_number (optional, int, None)
      Virtual slot number of a partition on which virtual network to be attached. This paramter is optional, if user doesn't pass, it chooses next available.



  npiv_config (optional, list, None)
    To configure N-Port ID Virtualization also known as Virtual Fibre of the partition

    User can provide two fc port configurations and mapping will be created with VIOS implicitly


    vios_name (True, str, None)
      The name of the vios in which fc port available

      This option is mandatory


    fc_port (True, str, None)
      The port to be used for npiv. User can specify either port name or fully qualified location code

      This option is mandatory


    wwpn_pair (optional, str, None)
      The WWPN pair value to be configuired with client FC adapter.

      Both the WWPN value should be separated with semicolon delimiter

      Optional, if not provided the value will be auto assigned



  all_resources (optional, bool, None)
    Create a partition withh all the resources available in the managed system.

    When we choose this as true, make sure that all partitions are in shutdown state, if any exist in managed system.

    Default is false


  max_virtual_slots (optional, int, None)
    Maximum virtual slots configuration of the partition.

    if user doesn't pass, it create partition with *max_virtual_slots* 20 as default.


  physical_io (optional, list, None)
    Physical IO adapter to be added to the partition

    An illustrative pattern for IO location code is XXXXX.XXX.XXXXXXX-P1-T1 or P1-T1


  retain_vios_cfg (optional, bool, None)
    Do not remove the VIOS configuration like server adapters, storage mappings associated with the partition when deleting the partition

    Applicable only for delete

    Default is to remove the associated VIOS configuration when deleting the partition


  delete_vdisks (optional, bool, None)
    Option to delete the Virtual Disks associated with the partition when deleting the partition

    Default is to not delete the virtual disks


  state (optional, str, None)
    ``present`` creates a partition of specifed *os_type*, *vm_name*, *proc* and *memory* on specified *system_name*

    ``absent`` deletes a partition of specified *vm_name* on specified *system_name*

    ``facts`` fetches a details of specified *vm_name* on specified *system_name*


  action (optional, str, None)
    ``shutdown`` shutdown a partition of specified *vm_name* on specified *system_name*

    ``poweron`` poweron a partition of specified *vm_name* with specified *prof_name*, *keylock*, *iIPLsource* on specified *system_name*

    ``restart`` restart a partition of specified *vm_name* on specified *system_name*





Notes
-----

.. note::
   - The network configuration currently will not support SRIOV or VNIC related configurations
   - *retain_vios_cfg* and *delete_vdisks* options will only be supported from HMC release level on or above V9 R1 M930
   - Partition creation is not supported for resource role based user in HMC Version prior to 951.




Examples
--------

.. code-block:: yaml+jinja

    
    - name: Create an IBMi logical partition instance with shared proc, volume_cong's vios_name and volume_name values, PhysicaIO and
            max_virtual_slots
      powervm_lpar_instance:
          hmc_host: '{{ inventory_hostname }}'
          hmc_auth:
             username: '{{ ansible_user }}'
             password: '{{ hmc_password }}'
          system_name: <system_name>
          vm_name: <vm_name>
          proc: 4
          proc_unit: 4
          mem: 20480
          volume_config:
             vios_name: <viosname>
             volume_name: <volumename>
          physical_io: <io location code>
          max_virtual_slots: 50
          os_type: ibmi
          state: present

    - name: Create an AIX/Linux logical partition instance with default proc, mem, virt_network_config, volume_config's volumes_size and
            npiv_config
      powervm_lpar_instance:
          hmc_host: '{{ inventory_hostname }}'
          hmc_auth:
             username: '{{ ansible_user }}'
             password: '{{ hmc_password }}'
          system_name: <system_name>
          vm_name: <vm_name>
          volume_config:
             volume_size: <size>
          virt_network_config:
             network_name: <virtual_nw_name>
             slot_number: <slot no>
          npiv_config:
             vios_name: <viosname>
             fc_port: <fc_poart_name/loc code>
             wwpn_pair: <wwpn1;wwpn2>
          os_type: aix_linux
          state: present

    - name: Delete a logical partition instance with retain_vios_cfg and delete_vdisk options
      powervm_lpar_instance:
          hmc_host: '{{ inventory_hostname }}'
          hmc_auth:
             username: '{{ ansible_user }}'
             password: '{{ hmc_password }}'
          system_name: <system_name>
          vm_name: <vm_name>
          retain_vios_cfg: True
          delete_vdisks: True
          state: absent

    - name: Shutdown a logical partition
      powervm_lpar_instance:
          hmc_host: '{{ inventory_hostname }}'
          hmc_auth:
             username: '{{ ansible_user }}'
             password: '{{ hmc_password }}'
          system_name: <system_name>
          vm_name: <vm_name>
          action: shutdown

    - name: Activate a AIX/Linux logical partition with user defined profile_name
      powervm_lpar_instance:
          hmc_host: '{{ inventory_hostname }}'
          hmc_auth:
             username: '{{ ansible_user }}'
             password: '{{ hmc_password }}'
          system_name: <system_name>
          vm_name: <vm_name>
          prof_name: <profile_name>
          action: poweron

    - name: Activate IBMi based on its current configuration with keylock and iIPLsource options
      powervm_lpar_instance:
          hmc_host: '{{ inventory_hostname }}'
          hmc_auth:
             username: '{{ ansible_user }}'
             password: '{{ hmc_password }}'
          system_name: <system_name>
          vm_name: <vm_name>
          keylock: 'norm'
          iIPLsource: 'd'
          action: poweron

    - name: Create a partition with All the resources
      powervm_lpar_instance:
          hmc_host: '{{ inventory_hostname }}'
          hmc_auth:
             username: '{{ ansible_user }}'
             password: '{{ hmc_password }}'
          system_name: <system_name>
          vm_name: <vm_name>
          all_resources: True
          state: present




Return Values
-------------

partition_info (on success for state C(present), dict, {'AllocatedVirtualProcessors': None, 'AssociatedManagedSystem': '<system-name>', 'CurrentMemory': 1024, 'CurrentProcessingUnits': None, 'CurrentProcessors': 1, 'Description': None, 'HasDedicatedProcessors': 'true', 'HasPhysicalIO': 'true', 'IsVirtualServiceAttentionLEDOn': 'false', 'LastActivatedProfile': 'default_profile', 'MemoryMode': 'Dedicated', 'MigrationState': 'Not_Migrating', 'OperatingSystemVersion': 'Unknown', 'PartitionID': 11, 'PartitionName': '<partition-name>', 'PartitionState': 'not activated', 'PartitionType': 'AIX/Linux', 'PowerManagementMode': None, 'ProgressState': None, 'RMCState': 'inactive', 'ReferenceCode': '', 'RemoteRestartState': 'Invalid', 'ResourceMonitoringIPAddress': None, 'SharingMode': 'sre idle proces'})
  The configuration of the partition after creation





Status
------




- This module is not guaranteed to have a backwards compatible interface. *[preview]*


- This module is maintained by community.



Authors
~~~~~~~

- Anil Vijayan (@AnilVijayan)
- Navinakumar Kandakur (@nkandak1)

