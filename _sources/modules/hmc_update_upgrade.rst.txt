.. _hmc_update_upgrade_module:


hmc_update_upgrade -- Manages the update and upgrade of the HMC
===============================================================

.. contents::
   :local:
   :depth: 1


Synopsis
--------

Updates the HMC by installing a corrective service package located on an FTP/SFTP/NFS server/Ansible Controller Node/HMC hard disk.

Upgrades the HMC by obtaining  the required  files  from a remote server or from the HMC hard disk. The files are transferred onto a special partition on the HMC hard disk. After the files have been transferred, HMC will boot from this partition and perform the upgrade.



Requirements
------------
The below requirements are needed on the host that executes this module.

- Python \>= 3



Parameters
----------

  hmc_host (True, str, None)
    The IPaddress or hostname of the HMC.


  hmc_auth (True, dict, None)
    Username and Password credential of the HMC.


    username (True, str, None)
      Username of the HMC to login.


    password (optional, str, None)
      Password of the HMC.



  build_config (False, dict, None)
    Configuration parameters required for the HMC update/upgrade.


    location_type (True, str, None)
      The type of location which contains the corrective service ISO image. Valid values are \ :literal:`disk`\  for the HMC hard disk, \ :literal:`ftp`\  for an FTP site, \ :literal:`sftp`\  for a secure FTP (SFTP) site, \ :literal:`nfs`\  for an NFS file system.

      When the location type is set to \ :literal:`disk`\ , first it looks for the \ :literal:`build\_file`\  in HMC hard disk if it doesn't exist then it looks for \ :literal:`build\_file`\  in the Ansible Controller node.


    hostname (optional, str, None)
      The hostname or IPaddress of the remote server where the corrective service ISO image is located.


    userid (optional, str, None)
      The user ID to use to log in to the remote FTP or SFTP server. This option is required when the ISO image is located on a remote FTP or SFTP server Otherwise, this option is not valid.


    passwd (optional, str, None)
      The password to use to log in to the remote FTP or SFTP server. The \ :emphasis:`passwd`\  and \ :emphasis:`sshkey`\  options are mutually exclusive in case if \ :emphasis:`location\_type=sftp`\ . This option is only valid when the ISO image is located on a remote FTP or SFTP server.


    sshkey_file (optional, str, None)
      The name of the file that contains the SSH private key. This option is only valid if \ :emphasis:`location\_type=sftp`\ .


    mount_location (optional, str, None)
      The mount location defined on the NFS server where the corrective service ISO image is located. This option is valid only if \ :emphasis:`location\_type=nfs`\ .


    build_file (optional, str, None)
      The name of the corrective service ISO image file. This  option  is required when the ISO image is located on any of the following locations HMC hard disk, Ansible controller node filesystem, remote FTP, SFTP, or NFS server. During upgrade of the HMC, this option represents the host path where the network install image is kept. During update of the HMC if \ :emphasis:`location\_type=disk`\  and ISO image is kept in Ansible controller node or HMC hard disk, this option should be provided with the ansible control node path in which ISO file or network install image is kept.



  state (True, str, None)
    The desired build state of the target HMC.

    \ :literal:`facts`\  does not change anything on the HMC and returns current driver/build level of HMC.

    \ :literal:`updated`\  ensures the target HMC is updated with given corrective service ISO image.

    \ :literal:`upgraded`\  ensures the target HMC is upgraded with given upgrade files.





Notes
-----

.. note::
   - Upgrade with \ :emphasis:`location\_type=disk`\  will not support for V8 R870 and V9 R1 M910 release of the HMC
   - Update with \ :emphasis:`location\_type=disk`\  and \ :emphasis:`build\_file`\  in the HMC local path won't remove the file after update.
   - Module will not satisfy the idempotency requirement of Ansible, even though it partially confirms it. For instance, if the module is tasked to update/upgrade the HMC to the same level, it will still go ahead with the operation and finally the changed state will be reported as false.
   - All Operations support passwordless authentication.




Examples
--------

.. code-block:: yaml+jinja

    
    - name: List the HMC current build level
      hmc_update_upgrade:
          hmc_host: '{{ inventory_hostname }}'
          hmc_auth:
             username: '{{ ansible_user }}'
             password: '{{ hmc_password }}'
          state: facts

    - name: Update the HMC to the V10R2M1040 build level from nfs location
      hmc_update_upgrade:
          hmc_host: '{{ inventory_hostname }}'
          hmc_auth:
             username: '{{ ansible_user }}'
             password: '{{ hmc_password }}'
          build_config:
              location_type: nfs
              hostname: <NFS_Server_IP/Hostname>
              build_file: /Images/MF70893-10.2.1040.0-2304262325-x86_64.iso
              mount_location: /HMCImages
          state: updated

    - name: Update the HMC to the V10R2M1041 build level from sftp location
      hmc_update_upgrade:
          hmc_host: '{{ inventory_hostname }}'
          hmc_auth:
             username: '{{ ansible_user }}'
             password: '{{ hmc_password }}'
          build_config:
              location_type: sftp
              hostname: <SFTP_Server_IP/Hostname>
              userid: <SFTP_Server_Username>
              passwd: <SFTP_Server_Password>
              build_file: /Images/MF71190-10.2.1041.0-2308160028-x86_64.iso
          state: updated




Return Values
-------------

build_info (always, dict, )
  Respective build information





Status
------




- This module is not guaranteed to have a backwards compatible interface. *[preview]*


- This module is maintained by community.



Authors
~~~~~~~

- Anil Vijayan (@AnilVijayan)
- Navinakumar Kandakur (@nkandak1)

