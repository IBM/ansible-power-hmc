sudo: required
dist: bionic
language: python
python:
  - "3.7"

# command to install dependencies
install:
  - pip install ansible
  - pip install flake8
  - pip install wheel       # for ansible-test
  - pip install Jinja2      # for ansible-test
  - pip3 install pyyaml     # for ansible-test
  - pip3 install voluptuous # for ansible-test
  - pip install pyyaml      # for compile test with Python2
  - pip3 install pylint     # for ansible-test
  - pip install yamllint    # for ansible-test
  - pip install pytest      # for pytest
  - pip install pytest-mock # for pytest
  - pip3 install rstcheck
  - ansible --version

env:
  global:
    secure: ATz92YiXdABv8CqFfSmrv6+HEDOuCHOnd5A7+51KOfp4gDMHP07rM3woRXWtSwSe8mMHDjCWO2WY090OjSdImzagcWFyW1IN8q245AmUhVZWNNT936uizNhwB2dfxrfYskiMDvThrrnde+lfVe7m5xrDGI0rSM6DRs3hi7Gdcpjs79RbaM1UIXyoHXv8IwEYBfnxArj7mG8FkW3MvaGwbIJAbTZFb4uWIyTWMaHByyq/C0q4PZsiz788u6hNI+XPmJW3OTpLX7/HJI63qwgUe+rK0oDOaKqusStxVqL9kXCzC3Th8OfektMST7JnCjq4KXzCqjkG+W6toPf49yY+Q90EqG77BM0CyWaKabIVgy5a08gVd3qzKbZtxIFHsx0xRJRk1NIH5tYLyrb2fFgmb/74xzSyiyt2Vj9wUgzyctspH84EyUr07HbRzvLTSaUQgqaz6NzW3bi9lvJIX+oDQNv4m0nxS1A50tsBzZfq04dXoeAl4+j8zykHcEnHdk6ZTWEzWpOhprc2/od361/bXLFR2jB6ay9lqOMWWn7GiLcEv7ND1xMjnUc7OOisf6fZ0+/Xm5w8usys3LR6W1PkPpGnTpQgITaA31tBxr87CY8dlE23oY73fNI1FFVUDjd2Fih7PptwcXaMv7oSeSYiLTRJBZP+7SAI6kB9/LmUIjI=

# command to run tests
script:

  # With flake ignore
  #  E402: <module> level import not at top of file (as per Ansible module developement)
  #  W503: line break before binary operator (PEP8 advices to put logical operator ahead)
  - flake8 plugins/modules/* --max-line-length=160 --ignore=E402,W503
  - flake8 plugins/module_utils/* --max-line-length=160 --ignore=E402,W503
  - flake8 tests/unit/*/* --max-line-length=160 --ignore=E402,W503
  - ansible-galaxy collection build
  - ansible-galaxy collection install ibm-power_hmc*
  - cd /home/travis/.ansible/collections/ansible_collections/ibm/power_hmc

  - pyenv global 3.7 3.6 2.7 
  - ansible-test sanity --python 3.7
  - cd /home/travis/.ansible/collections/
  - python -m pytest
