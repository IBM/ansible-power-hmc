

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>powervm_inventory – HMC-based inventory source for Power Systems &mdash; IBM Power Systems HMC 1.0.0-beta1 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Playbooks" href="../playbooks.html" />
    <link rel="prev" title="Plugins" href="../plugins.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> IBM Power Systems HMC
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quickstart</a></li>
</ul>
<p class="caption"><span class="caption-text">References</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../modules.html">Modules</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../plugins.html">Plugins</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../plugins.html#plugin-reference">Plugin reference</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">powervm_inventory – HMC-based inventory source for Power Systems</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#synopsis">Synopsis</a></li>
<li class="toctree-l4"><a class="reference internal" href="#requirements">Requirements</a></li>
<li class="toctree-l4"><a class="reference internal" href="#parameters">Parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#examples">Examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="#status">Status</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../playbooks.html">Playbooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demo.html">Demo</a></li>
</ul>
<p class="caption"><span class="caption-text">Community Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../community_guides.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../community_guides.html#helpful-links">Helpful Links</a></li>
</ul>
<p class="caption"><span class="caption-text">Requirements</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../requirements.html">Requirements</a></li>
</ul>
<p class="caption"><span class="caption-text">Appendices</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../release_notes.html">Releases</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">IBM Power Systems HMC</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../plugins.html">Plugins</a> &raquo;</li>
        
      <li>powervm_inventory – HMC-based inventory source for Power Systems</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/IBM/ansible-power-hmc/blob/dev-collection/docs/source/plugins/powervm_inventory.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="powervm-inventory-hmc-based-inventory-source-for-power-systems">
<span id="powervm-inventory-module"></span><h1>powervm_inventory – HMC-based inventory source for Power Systems<a class="headerlink" href="#powervm-inventory-hmc-based-inventory-source-for-power-systems" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#synopsis" id="id1">Synopsis</a></p></li>
<li><p><a class="reference internal" href="#requirements" id="id2">Requirements</a></p></li>
<li><p><a class="reference internal" href="#parameters" id="id3">Parameters</a></p></li>
<li><p><a class="reference internal" href="#examples" id="id4">Examples</a></p></li>
<li><p><a class="reference internal" href="#status" id="id5">Status</a></p></li>
</ul>
</div>
<div class="section" id="synopsis">
<h2><a class="toc-backref" href="#id1">Synopsis</a><a class="headerlink" href="#synopsis" title="Permalink to this headline">¶</a></h2>
<p>This plugin utilizes HMC APIs to build a dynamic inventory of defined partitions (LPAR, VIOS). Inventory sources must be structured as name.power_hmc.yml or name.power_hmc.yaml.</p>
<p>To create a usable Ansible host for a given LPAR, the ip or hostname of the LPAR must be exposed through the HMC in some way. Currently there are only 2 such sources supported by this tool, an RMC ip address or the name of the LPAR must be a valid hostname.</p>
<p>Valid LPAR/VIOS properties that can be used for groups, keyed groups, filters, unknown partition identification, and composite variables can be found in the HMC REST API documentation. By default, valid properties include those listed as “Quick Properties”, but if <cite>advanced_fields</cite> are enabled you may use properties included in the “Advanced” group as well.</p>
</div>
<div class="section" id="requirements">
<h2><a class="toc-backref" href="#id2">Requirements</a><a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h2>
<p>The below requirements are needed on the host that executes this module.</p>
<ul class="simple">
<li><p>Python &gt;= 3</p></li>
</ul>
</div>
<div class="section" id="parameters">
<h2><a class="toc-backref" href="#id3">Parameters</a><a class="headerlink" href="#parameters" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><dl>
<dt>hmc_hosts (True, dict, None)</dt><dd><p>A dictionary of hosts and their associated usernames and passwords.</p>
</dd>
<dt>filters (optional, any, {})</dt><dd><p>A key value pair for filtering by various LPAR/VIOS attributes. Only results matching the filter will be included in the inventory.</p>
</dd>
<dt>compose (optional, dict, {})</dt><dd><p>Create vars from jinja2 expressions.</p>
</dd>
<dt>groups (optional, dict, {})</dt><dd><p>Add hosts to group based on Jinja2 conditionals.</p>
</dd>
<dt>keyed_groups (optional, list, [])</dt><dd><p>Add hosts to group based on the values of a variable.</p>
</dd>
<dt>exclude_ip (optional, list, [])</dt><dd><p>A list of IP addresses to exclude from the inventory. This will be compared to the RMC ip address specified in the HMC. Currently, no hostname lookup is performed, so only ip addresses that match the RMC ip address specified in the HMC will be exlcuded.</p>
</dd>
<dt>exclude_lpar (optional, list, [])</dt><dd><p>A list of partitions (LPAR, VIOS) to exclude by partition name.</p>
</dd>
<dt>exclude_system (optional, list, [])</dt><dd><p>A list of HMC managed systems whose partitions (LPAR, VIOS) will be excluded from the dynamic inventory.</p>
</dd>
<dt>ansible_display_name (optional, str, lpar_name)</dt><dd><p>By default, partitions names will be used as the name displayed by Ansible in output. If you wish this to display the ip address instead you may set this to “ip”.</p>
</dd>
<dt>ansible_host_type (optional, str, ip)</dt><dd><p>Determines if the ip address or the LPAR name will be used as the “ansible_host” variable in playbooks.</p>
</dd>
<dt>advanced_fields (optional, bool, False)</dt><dd><p>Allows for additional LPAR/VIOS properties to be used for the purposes of grouping and filtering.</p>
<p>Retrieving these properties requires a significantly slower call to HMC APIs. Depending on the size of your environment, it could increase dynamic inventory generation run time dramatically.</p>
</dd>
<dt>group_by_managed_system (optional, bool, True)</dt><dd><p>Creates a grouping of partitions by managed system name. This is enabled by default.</p>
</dd>
<dt>identify_unknown_by (optional, str, omit)</dt><dd><p>Allows you to include partitions unable to be automatically detected as a valid Ansible target.</p>
<p>By default, partitions without ip’s are ommited from the inventory. This is not be the case in the event you have lpar_name set for ansible_host_type. If not, omitted partitions will be added to a group called “unknown” and will can be identified by any LPAR property of your choosing (PartitionName or UUID are common identifiers).</p>
<p>If you do not omit unknown partitions, you may run into issues targetting groups that include them. To avoid this you can specify a host pattern in a playbooks such as <cite>targetgroup:!unknown</cite>. This will your playbook to run against all known hosts in your target group.</p>
</dd>
</dl>
</div></blockquote>
</div>
<div class="section" id="examples">
<h2><a class="toc-backref" href="#id4">Examples</a><a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="c1"># The most minimal example, targetting only a single HMC</span>
<span class="nt">plugin</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ibm.power_hmc.powervm_inventory</span>
<span class="nt">hmc_hosts</span><span class="p">:</span>
  <span class="s">&quot;hmc_url1&quot;</span><span class="p p-Indicator">:</span>
    <span class="nt">user</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">user</span>
    <span class="nt">password</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">password</span>
<span class="c1"># Target multiple HMC hosts and only add running partitions to the inventory</span>
<span class="nt">plugin</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ibm.power_hmc.powervm_inventory</span>
<span class="nt">hmc_hosts</span><span class="p">:</span>
  <span class="s">&quot;hmc_url1&quot;</span><span class="p p-Indicator">:</span>
    <span class="nt">user</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">user</span>
    <span class="nt">password</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">password</span>
  <span class="s">&quot;hmc_url2&quot;</span><span class="p p-Indicator">:</span>
    <span class="nt">user</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">user</span>
    <span class="nt">password</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">password</span>
<span class="nt">filters</span><span class="p">:</span>
    <span class="nt">PartitionState</span><span class="p">:</span> <span class="s">&#39;running&#39;</span>

<span class="c1"># Generate an inventory including all running partitions and also create a group allowing us to target AIX 7.2 specifically</span>
<span class="nt">plugin</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ibm.power_hmc.powervm_inventory</span>
<span class="nt">hmc_hosts</span><span class="p">:</span>
  <span class="s">&quot;hmc_url1&quot;</span><span class="p p-Indicator">:</span>
    <span class="nt">user</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">user</span>
    <span class="nt">password</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">password</span>
  <span class="s">&quot;hmc_url2&quot;</span><span class="p p-Indicator">:</span>
    <span class="nt">user</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">user</span>
    <span class="nt">password</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">password</span>
<span class="nt">filters</span><span class="p">:</span>
    <span class="nt">PartitionState</span><span class="p">:</span> <span class="s">&#39;running&#39;</span>
<span class="nt">groups</span><span class="p">:</span>
    <span class="nt">AIX_72</span><span class="p">:</span> <span class="s">&quot;&#39;7.2&#39;</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">OperatingSystemVersion&quot;</span>

<span class="c1"># Generate an inventory of running partitions and group them by PartitionType with a prefix of type_</span>
<span class="c1"># Groups will be created will resemble &quot;type_Virtual_IO_Server&quot;, &quot;type_AIX_Linux&quot;, etc.</span>
<span class="c1"># Additionally, include the following variables as host_vars for a given target host: CurrentMemory, OperatingSystemVersion, PartitionName</span>
<span class="nt">plugin</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ibm.power_hmc.powervm_inventory</span>
<span class="nt">hmc_hosts</span><span class="p">:</span>
  <span class="s">&quot;hmc_url1&quot;</span><span class="p p-Indicator">:</span>
    <span class="nt">user</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">user</span>
    <span class="nt">password</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">password</span>
  <span class="s">&quot;hmc_url2&quot;</span><span class="p p-Indicator">:</span>
    <span class="nt">user</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">user</span>
    <span class="nt">password</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">password</span>
<span class="nt">filters</span><span class="p">:</span>
    <span class="nt">PartitionState</span><span class="p">:</span> <span class="s">&#39;running&#39;</span>
<span class="nt">keyed_groups</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">prefix</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">type</span>
    <span class="nt">key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">PartitionType</span>
<span class="nt">compose</span><span class="p">:</span>
  <span class="nt">current_memory</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">CurrentMemory</span>
  <span class="nt">os</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">OperatingSystemVersion</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">PartitionName</span>

<span class="c1">## Generate an inventory that excludes partitions by ip, name, or the name of managed system on which they run</span>
<span class="nt">plugin</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ibm.power_hmc.powervm_inventory</span>
<span class="nt">hmc_hosts</span><span class="p">:</span>
  <span class="s">&quot;hmc_url1&quot;</span><span class="p p-Indicator">:</span>
    <span class="nt">user</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">user</span>
    <span class="nt">password</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">password</span>
<span class="nt">exclude_ip</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">10.0.0.44</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">10.0.0.46</span>
<span class="nt">exclude_lpar</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">aixlparnameX1</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">aixlparnameX2</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">vioslparnameX1</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">vioslparnameX2</span>
<span class="nt">exclude_system</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">Frame1-XXX-WWWWWW</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">Frame2-XXX-WWWWWW</span>
</pre></div>
</div>
</div>
<div class="section" id="status">
<h2><a class="toc-backref" href="#id5">Status</a><a class="headerlink" href="#status" title="Permalink to this headline">¶</a></h2>
<div class="section" id="authors">
<h3>Authors<a class="headerlink" href="#authors" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Torin Reilly (&#64;torinreilly)</p></li>
<li><p>Michael Cohoon (&#64;mtcohoon)</p></li>
<li><p>Ozzie Rodriguez</p></li>
</ul>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../playbooks.html" class="btn btn-neutral float-right" title="Playbooks" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../plugins.html" class="btn btn-neutral float-left" title="Plugins" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, IBM

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>